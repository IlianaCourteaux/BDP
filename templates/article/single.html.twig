{% extends 'base.html.twig' %}

{% block body %}

{# Corps de l'article #}
<div class="single-article">

<img class="banner" src="{{ asset('img/uploads/' ~ article.banner.fileName) }}" alt="{{ article.title }}">

<div>
<h1 class="title">{{ article.title }}</h1>
</div>

<div class="details">
<p>Auteur·ice : {{ article.author }}</p>
<p>Publication : {{ article.createdAt|date('d M Y') }}</p>
{% if article.updatedAt %}
<p> Dernière mise à jour : {{ article.updatedAt|date('d M Y') }}
{% endif %}
</div>

<div>
<p class="text">{{ article.text|nl2br }}</p>
</div>

{# Formulaire de commentaires #}
<section class="comment">
    <h3>Laisser un commentaire</h3>

    {% for message in app.flashes('success') %}
        <div>
            {{ message }}
        </div>
    {% endfor %}
    
    <div class="comment_form">{{ form(commentForm) }}</div>

    <h3>{{ article.comments|length }} commentaire(s)</h3>

{# Liste des commentaires #}
    <div class="comment_list">
        {% for comment in comments %}
            {% if comment.parent == null %} 
                {# {% include 'comments/index.html.twig' with [comment] %} #}
                <div class="comment_item">
                    <p class="comment_info"><span class="comment_author">{{ comment.user.username }}</span>, le {{ comment.createdAt|date('d M Y à H:i') }}</p>
                    <p class="comment_message">{{ comment.text|raw }}</p>
                    <p> <a href="#comment_form" class="submit_button" data-reply data-id="{{ comment.id }}">Répondre</a></p>
                </div>
                {% for reply in comment.replies %}
                <div class="comment_item">
                    <p class="comment_info">Réponse de <span class="comment_author">{{ reply.user.username }}</span>, le {{ reply.createdAt|date('d M Y à H:i') }}</p>
                    <p class="comment_message">{{ reply.text|raw }}</p>
                </div>
                {% endfor %}
            {% endif %}
        {% endfor %}
    </div>

{# Pagination #}
    <div class="row">
        <div>
            {{ knp_pagination_render(comments) }}
        </div>
    </div>

<section>

</div>

{% endblock %}

{# Script pour réponses aux commentaires #}
{% block javascripts %}
    <script>
        window.onload = () => {
            document.querySelectorAll("[data-reply]").forEach(element => {
                element.addEventListener("click", function(){
                    document.querySelector("#comments_parent").value = this.dataset.id;
                })
            })
        }
    </script>
{% endblock %}